{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-09T18:03:01.346Z",
  "summary": "Frontend adds an in-app timed \"Watch Ad to Unlock\" dialog, a premium gate hook used by CaptionGenerator, a credits display/button on GeneratorsPage, and an Affiliate Resources section with centralized link definitions. However, the backend credit system/methods required for persistent per-user credits are not evidenced in the diff, and the watch-ad flow does not actually grant or consume credits via backend calls, so premium gating cannot reliably work end-to-end.",
  "missing_requirements": [
    {
      "id": "REQ-24",
      "requirement": "Backend exposes methods to get the caller's unlock/credit state, grant credits for a completed ad-watch event, and optionally consume a credit when unlocking a premium output; credits persist per authenticated principal across sessions.",
      "reason": "Frontend queries actor.getCredits(), but the diff does not show backend methods (e.g., getCredits/grantCredits/consumeCredit) being implemented. Additionally, the WatchAdDialog explicitly simulates granting credits without calling the backend, so there is no evidence of persisted per-user credit balance or authenticated scoping being functional end-to-end.",
      "evidence": [
        "frontend/src/hooks/useQueries.ts (useGetCredits calls actor.getCredits; useAddCredits throws 'Backend missing user-callable grantCreditsAfterAd method')",
        "frontend/src/components/ads/WatchAdDialog.tsx (comments indicate simulated granting; no backend call shown)",
        "backend/main.mo (truncated; no credit methods shown in provided excerpt)",
        "backend/migration.mo (adds viewAdsUnlockMap state but does not evidence public methods to use it)"
      ]
    },
    {
      "id": "REQ-25",
      "requirement": "Premium gating uses ad-unlock credits: block an advanced/premium action if no credits, prompt to watch ad, and after credits are granted allow completing the previously blocked action without navigation; handle loading/error states with English messages.",
      "reason": "CaptionGenerator gates an advanced action (copy extended pack) via usePremiumGate, but credits are never actually granted (WatchAdDialog does not call backend; useAddCredits is unimplemented and throws). There is also no evidence that a credit is consumed when the premium action succeeds, meaning the gating isn't tied to a real balance. Without real credit mutation, the 'retry after credits are granted' flow is not reliably satisfied.",
      "evidence": [
        "frontend/src/components/generators/CaptionGenerator.tsx (handleCopyExtended uses executeWithGate but no consume-credit call)",
        "frontend/src/components/ads/usePremiumGate.ts (only checks useGetCredits; no consume)",
        "frontend/src/components/ads/WatchAdDialog.tsx (simulates completion and invalidates query, but does not grant credits through backend)",
        "frontend/src/hooks/useQueries.ts (useAddCredits throws backend-missing error)"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Added a useAddCredits hook that intentionally throws an error about a missing backend method, effectively shipping a non-functional credits-granting mutation path.",
      "reason": "The BuildRequest requires a working credit grant flow; introducing a stubbed hook that always errors is additional behavior not requested and undermines the required implementation.",
      "evidence": [
        "frontend/src/hooks/useQueries.ts (useAddCredits throws 'Backend missing user-callable grantCreditsAfterAd method')"
      ]
    }
  ],
  "confidence": 0.74,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/components/ads/WatchAdDialog.tsx",
    "frontend/src/components/ads/usePremiumGate.ts",
    "frontend/src/components/generators/CaptionGenerator.tsx",
    "frontend/src/components/monetization/AffiliateResourcesSection.tsx",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/lib/affiliateResources.ts",
    "frontend/src/pages/GeneratorsPage.tsx",
    "frontend/src/pages/MonetizationPage.tsx",
    "project_state.json"
  ]
}