{
  "kind": "build_request",
  "title": "Add ad-based unlocks and affiliate link placements (non-Stripe monetization)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-24",
      "text": "Implement a \"view-ads-to-unlock\" system that lets an authenticated user unlock premium/advanced outputs by completing an in-app ad-watching flow (no third-party ad network required). The system must track a per-user unlock balance (credits) that persists across sessions.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-12"
        ],
        "quotes": [
          "Add second and third"
        ]
      },
      "acceptanceCriteria": [
        "Backend exposes methods to: (1) get the caller's current unlock/credit state, (2) grant credits for a completed 'ad watch' event, and (3) optionally consume a credit when unlocking a premium output.",
        "Unlock/credit state is scoped to the authenticated principal and persists after refresh/relogin.",
        "Frontend provides a clear UI flow to 'Watch an ad to unlock' that completes after a short timed 'ad' experience and then grants at least 1 credit.",
        "User-facing text is in English.",
        "No third-party ad SDK or external ad provider integration is required or used."
      ]
    },
    {
      "id": "REQ-25",
      "text": "Add premium gating that uses the ad-unlock credits: when the user attempts to access an advanced/premium action, the app must either (a) allow it if the user has sufficient unlock credits or (b) prompt the user to watch an ad to earn credits and then retry the action after credits are granted.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-12"
        ],
        "quotes": [
          "Add second and third"
        ]
      },
      "acceptanceCriteria": [
        "At least one clearly identified advanced/premium action in the Generators experience is gated behind unlock credits (e.g., revealing an extended output variant, exporting/copying an extended version, or generating additional variants beyond the default).",
        "If the user has no credits, the UI presents a blocking prompt explaining they can watch an ad to unlock, with a clear cancel path.",
        "After completing the watch-ad flow and receiving credits, the user can complete the previously blocked action without needing to navigate away.",
        "UI states handle loading and error cases (e.g., failed credit grant) with an English error message."
      ]
    },
    {
      "id": "REQ-26",
      "text": "Add affiliate link placements inside the authenticated Monetization section: provide a dedicated area that lists recommended tools/resources with outbound affiliate links and an affiliate disclosure. The list must be easy to scan and each item must support opening the link in a new tab.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-12"
        ],
        "quotes": [
          "Add second and third"
        ]
      },
      "acceptanceCriteria": [
        "The Monetization page includes an \"Affiliate Resources\" (or similarly named) section visible to authenticated users.",
        "The section includes an English affiliate disclosure (e.g., 'Some links may be affiliate links and we may earn a commission at no extra cost to you.').",
        "Each affiliate item shows at minimum: name, short description, and a button/link that opens in a new tab with rel=\"noopener noreferrer\".",
        "Affiliate links are defined in a single, maintainable place in the frontend (e.g., a small constant list), so they can be edited without touching multiple components."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo; do not introduce additional backend services.",
    "Generate backend/migration.mo changes only if required by persisted state changes (conditional migration policy).",
    "Do not edit files under frontend/src/components/ui or any other immutable paths listed in SYSTEM_CONTEXT.",
    "Do not add Stripe or any external payment integration.",
    "Do not integrate third-party ad networks/SDKs; the 'ad' experience must be implemented fully in-app."
  ],
  "nonGoals": [
    "Implementing real subscription billing ($5.9/month) or paywall checkout flows.",
    "Implementing real ad network inventory, ad serving, or ad revenue reporting.",
    "Implementing a full affiliate tracking system with conversions/attribution; only outbound link placement and disclosure are required."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}